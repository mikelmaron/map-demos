var times = ['2002-04-18T00:00:00', '2002-05-10T00:00:00', '2002-08-16T00:00:00', '2002-09-16T00:00:00', '2002-10-16T00:00:00', '2002-11-16T00:00:00', '2002-12-16T00:00:00', '2003-01-16T00:00:00', '2003-02-15T00:00:00', '2003-03-16T00:00:00', '2003-04-16T00:00:00', '2003-05-11T00:00:00', '2003-07-16T00:00:00', '2003-08-16T00:00:00', '2003-09-16T00:00:00', '2003-10-16T00:00:00', '2003-11-16T00:00:00', '2003-12-16T00:00:00', '2004-01-07T00:00:00', '2004-02-17T00:00:00', '2004-03-16T00:00:00', '2004-04-16T00:00:00', '2004-05-16T00:00:00', '2004-06-16T00:00:00', '2004-07-16T00:00:00', '2004-08-16T00:00:00', '2004-09-16T00:00:00', '2004-10-16T00:00:00', '2004-11-16T00:00:00', '2004-12-16T00:00:00', '2005-01-16T00:00:00', '2005-02-15T00:00:00', '2005-03-16T00:00:00', '2005-04-16T00:00:00', '2005-05-16T00:00:00', '2005-06-16T00:00:00', '2005-07-16T00:00:00', '2005-08-16T00:00:00', '2005-09-16T00:00:00', '2005-10-16T00:00:00', '2005-11-16T00:00:00', '2005-12-16T00:00:00', '2006-01-16T00:00:00', '2006-02-15T00:00:00', '2006-03-16T00:00:00', '2006-04-16T00:00:00', '2006-05-16T00:00:00', '2006-06-16T00:00:00', '2006-07-16T00:00:00', '2006-08-16T00:00:00', '2006-09-16T00:00:00', '2006-10-16T00:00:00', '2006-11-16T00:00:00', '2006-12-16T00:00:00', '2007-01-16T00:00:00', '2007-02-14T00:00:00', '2007-03-16T00:00:00', '2007-04-16T00:00:00', '2007-05-16T00:00:00', '2007-06-16T00:00:00', '2007-07-16T00:00:00', '2007-08-16T00:00:00', '2007-09-16T00:00:00', '2007-10-16T00:00:00', '2007-11-16T00:00:00', '2007-12-16T00:00:00', '2008-01-16T00:00:00', '2008-02-15T00:00:00', '2008-03-16T00:00:00', '2008-04-16T00:00:00', '2008-05-16T00:00:00', '2008-06-16T00:00:00', '2008-07-16T00:00:00', '2008-08-16T00:00:00', '2008-09-16T00:00:00', '2008-10-16T00:00:00', '2008-11-16T00:00:00', '2008-12-16T00:00:00', '2009-01-16T00:00:00', '2009-02-15T00:00:00', '2009-03-16T00:00:00', '2009-04-16T00:00:00', '2009-05-16T00:00:00', '2009-06-16T00:00:00', '2009-07-16T00:00:00', '2009-08-16T00:00:00', '2009-09-16T00:00:00', '2009-10-16T00:00:00', '2009-11-16T00:00:00', '2009-12-16T00:00:00', '2010-01-16T00:00:00', '2010-02-15T00:00:00', '2010-03-16T00:00:00', '2010-04-16T00:00:00', '2010-05-16T00:00:00', '2010-06-16T00:00:00', '2010-07-16T00:00:00', '2010-08-16T00:00:00', '2010-09-16T00:00:00', '2010-10-16T00:00:00', '2010-11-16T00:00:00', '2010-12-14T00:00:00', '2011-02-18T00:00:00', '2011-03-16T00:00:00', '2011-04-16T00:00:00', '2011-05-16T00:00:00', '2011-07-18T00:00:00', '2011-08-16T00:00:00', '2011-09-16T00:00:00', '2011-10-16T00:00:00', '2011-10-31T00:00:00', '2011-12-28T00:00:00', '2012-01-16T00:00:00', '2012-02-15T00:00:00', '2012-03-16T00:00:00', '2012-04-04T00:00:00', '2012-06-16T00:00:00', '2012-07-16T00:00:00', '2012-08-16T00:00:00', '2012-09-13T00:00:00', '2012-11-18T00:00:00', '2012-12-16T00:00:00', '2013-01-16T00:00:00', '2013-02-14T00:00:00', '2013-04-21T00:00:00', '2013-05-16T00:00:00', '2013-06-16T00:00:00', '2013-07-16T00:00:00', '2013-10-16T00:00:00', '2013-11-16T00:00:00', '2013-12-16T00:00:00', '2014-01-09T00:00:00', '2014-03-17T00:00:00', '2014-04-16T00:00:00', '2014-05-16T00:00:00', '2014-06-13T00:00:00', '2014-08-16T00:00:00', '2014-09-16T00:00:00', '2014-10-16T00:00:00', '2014-11-16T00:00:00', '2015-01-22T00:00:00', '2015-02-15T00:00:00', '2015-03-16T00:00:00', '2015-04-16T00:00:00', '2015-04-27T00:00:00', '2015-07-15T00:00:00', '2015-08-16T00:00:00', '2015-09-14T00:00:00', '2015-12-23T00:00:00', '2016-01-16T00:00:00', '2016-02-14T00:00:00', '2016-03-16T00:00:00', '2016-05-20T00:00:00', '2016-06-16T00:00:00', '2016-07-15T00:00:00', '2016-08-21T00:00:00', '2016-11-27T00:00:00', '2016-12-24T00:00:00', '2017-01-21T00:00:00', '2017-03-31T00:00:00', '2017-04-24T00:00:00', '2017-05-13T00:00:00', '2017-06-10T00:00:00', '2018-06-16T00:00:00', '2018-07-10T00:00:00', '2018-10-31T00:00:00', '2018-11-16T00:00:00', '2018-12-16T00:00:00', '2019-01-16T00:00:00', '2019-02-15T00:00:00', '2019-03-16T00:00:00', '2019-04-16T00:00:00', '2019-05-16T00:00:00', '2019-06-16T00:00:00', '2019-07-16T00:00:00', '2019-08-16T00:00:00', '2019-09-16T00:00:00', '2019-10-16T00:00:00', '2019-11-16T00:00:00', '2019-12-16T00:00:00', '2020-01-16T00:00:00', '2020-02-15T00:00:00', '2020-03-16T00:00:00', '2020-04-16T00:00:00', '2020-05-16T00:00:00', '2020-06-16T00:00:00', '2020-07-16T00:00:00', '2020-08-16T00:00:00', '2020-09-16T00:00:00', '2020-10-16T00:00:00', '2020-11-16T00:00:00', '2020-12-16T00:00:00', '2021-01-16T00:00:00', '2021-02-15T00:00:00', '2021-03-16T00:00:00', '2021-04-16T00:00:00', '2021-05-16T00:00:00', '2021-06-16T00:00:00', '2021-07-16T00:00:00', '2021-08-16T00:00:00', '2021-09-16T00:00:00', '2021-10-16T00:00:00', '2021-11-16T00:00:00', '2021-12-16T00:00:00', '2022-01-16T00:00:00', '2022-02-15T00:00:00', '2022-03-16T00:00:00', '2022-04-16T00:00:00', '2022-05-16T00:00:00', '2022-06-16T00:00:00', '2022-07-16T00:00:00', '2022-08-16T00:00:00'];

function createLayers() {
    map.addSource('greenland-hex', {
        type: 'vector',
        url: 'mapbox://earthrise.0lfqocjh'
    });

    times.forEach(time =>  {
        map.addLayer({
            'id': time,
            'type': 'fill',
            'source': 'greenland-hex',
            'source-layer': 'hex_dataset',
            'paint': {
                'fill-color': [
                    "interpolate",
                    ["linear"],
                    ["get", "lwe_thickness"],
                    -1401.2368842230903,
                    "hsl(0, 100%, 53%)",
                    358.5379139293324,
                    "hsl(197, 99%, 63%)"
                  ],
                'fill-opacity': 0
            },
            'filter': [
                "all",
                [
                  "match",
                  ["get", "time"],
                  [time],
                  true,
                  false
                ]
              ]

        });   
    });
}

var chapters = [];
times.forEach((time, index) => {
    var chapter = {};
    chapter.id = time;
    chapter.hidden = true;
    chapter.rotateAnimation = true;
    if (index == 0) {
        chapter.location = {
            center: [-43.77, 76.39],
            zoom: 3.5,
            bearing: 0,
            pitch: 0           
        }
    }
    chapter.delay = 100;
    chapter.rotateDegree = 1;
    chapter.onChapterEnter = [
        {
            layer: time,
            opacity: 1
        }
    ];
    chapter.onChapterExit = [
        {
            layer: time,
            opacity: 1
        }
    ];
    chapters.push(chapter);
});

var config = {
    style: 'mapbox://styles/earthrise/clchzj050001i14qr5orncz2v',
    accessToken: 'pk.eyJ1IjoiZWFydGhyaXNlIiwiYSI6ImNqeDExNmtrZzAwM2E0OW16eHZ1dzg1eWEifQ.8LTFXyY-n7OsZOoWN9ONPQ',
    showMarkers: false,
    markerColor: '#3FB1CE',
    //projection: 'equirectangular',
    //Read more about available projections here
    //https://docs.mapbox.com/mapbox-gl-js/example/projections/
    inset: false,
    theme: 'dark',
    use3dTerrain: false, //set true for enabling 3D maps.
    auto: true,
    title: '',
    subtitle: '',
    byline: '',
    footer: '',
    onMapLoad: 'createLayers',
    chapters: chapters
};
